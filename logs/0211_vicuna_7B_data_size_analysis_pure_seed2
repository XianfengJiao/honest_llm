Running:
data_size_analysis_act.py --seed=2 --pure

Namespace(alpha=12, dataset_name='tqa_mc2', device=0, info_name='ft:davinci-002:university-of-edinburgh:info:8ejuTaQe', judge_name='ft:davinci-002:university-of-edinburgh::8ejp8D64', model_name='llama_7B', n_clusters=3, num_fold=1, num_heads=24, probe_base_weight=0.5, probe_type='prob', pure=True, seed=2, train_ratio=0.9, val_ratio=0.2)
experiments_path: /data/jxf/honest_llm/cluster_experiments/data_analyze_llama_7B_seed2_pure
Found cached dataset parquet (/home/jxf/.cache/huggingface/datasets/parquet/default-45ee6c5a774c2d3f/0.0.0/14a00e99c0d15a23649d0db8944380ac81082d4b021f398733dd84f3a6c569a7)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 191.07it/s]
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:06<00:06,  6.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.70s/it]
Found cached dataset parquet (/home/jxf/.cache/huggingface/datasets/parquet/default-45ee6c5a774c2d3f/0.0.0/14a00e99c0d15a23649d0db8944380ac81082d4b021f398733dd84f3a6c569a7)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 300.00it/s]
Running fold 0
gen cluster-3 mean directions::   0%|          | 0/32 [00:00<?, ?it/s]gen cluster-3 mean directions::   3%|▎         | 1/32 [00:01<00:53,  1.71s/it]gen cluster-3 mean directions::   6%|▋         | 2/32 [00:03<00:49,  1.64s/it]gen cluster-3 mean directions::   9%|▉         | 3/32 [00:04<00:44,  1.52s/it]gen cluster-3 mean directions::  12%|█▎        | 4/32 [00:06<00:42,  1.52s/it]gen cluster-3 mean directions::  16%|█▌        | 5/32 [00:07<00:39,  1.46s/it]gen cluster-3 mean directions::  19%|█▉        | 6/32 [00:08<00:37,  1.45s/it]gen cluster-3 mean directions::  22%|██▏       | 7/32 [00:10<00:35,  1.43s/it]gen cluster-3 mean directions::  25%|██▌       | 8/32 [00:11<00:34,  1.44s/it]gen cluster-3 mean directions::  28%|██▊       | 9/32 [00:13<00:34,  1.50s/it]gen cluster-3 mean directions::  31%|███▏      | 10/32 [00:17<00:47,  2.14s/it]gen cluster-3 mean directions::  34%|███▍      | 11/32 [00:20<00:55,  2.65s/it]gen cluster-3 mean directions::  38%|███▊      | 12/32 [00:24<00:58,  2.91s/it]gen cluster-3 mean directions::  41%|████      | 13/32 [00:27<00:58,  3.09s/it]gen cluster-3 mean directions::  44%|████▍     | 14/32 [00:31<00:57,  3.19s/it]gen cluster-3 mean directions::  47%|████▋     | 15/32 [00:34<00:54,  3.23s/it]gen cluster-3 mean directions::  50%|█████     | 16/32 [00:37<00:52,  3.25s/it]gen cluster-3 mean directions::  53%|█████▎    | 17/32 [00:41<00:50,  3.37s/it]gen cluster-3 mean directions::  56%|█████▋    | 18/32 [00:44<00:46,  3.35s/it]gen cluster-3 mean directions::  59%|█████▉    | 19/32 [00:48<00:42,  3.30s/it]gen cluster-3 mean directions::  62%|██████▎   | 20/32 [00:51<00:38,  3.22s/it]gen cluster-3 mean directions::  66%|██████▌   | 21/32 [00:54<00:36,  3.28s/it]gen cluster-3 mean directions::  69%|██████▉   | 22/32 [00:58<00:33,  3.38s/it]gen cluster-3 mean directions::  72%|███████▏  | 23/32 [01:01<00:30,  3.37s/it]gen cluster-3 mean directions::  75%|███████▌  | 24/32 [01:04<00:26,  3.37s/it]gen cluster-3 mean directions::  78%|███████▊  | 25/32 [01:08<00:23,  3.32s/it]gen cluster-3 mean directions::  81%|████████▏ | 26/32 [01:11<00:19,  3.24s/it]gen cluster-3 mean directions::  84%|████████▍ | 27/32 [01:14<00:16,  3.24s/it]gen cluster-3 mean directions::  88%|████████▊ | 28/32 [01:17<00:12,  3.19s/it]gen cluster-3 mean directions::  91%|█████████ | 29/32 [01:20<00:09,  3.22s/it]gen cluster-3 mean directions::  94%|█████████▍| 30/32 [01:23<00:06,  3.19s/it]gen cluster-3 mean directions::  97%|█████████▋| 31/32 [01:27<00:03,  3.21s/it]gen cluster-3 mean directions:: 100%|██████████| 32/32 [01:30<00:00,  3.36s/it]gen cluster-3 mean directions:: 100%|██████████| 32/32 [01:30<00:00,  2.84s/it]
train probes:   0%|          | 0/32 [00:00<?, ?it/s]train probes:   3%|▎         | 1/32 [00:12<06:36, 12.80s/it]train probes:   6%|▋         | 2/32 [00:25<06:30, 13.02s/it]train probes:   9%|▉         | 3/32 [00:39<06:26, 13.34s/it]train probes:  12%|█▎        | 4/32 [00:52<06:12, 13.29s/it]train probes:  16%|█▌        | 5/32 [01:06<06:00, 13.36s/it]train probes:  19%|█▉        | 6/32 [01:19<05:48, 13.42s/it]train probes:  22%|██▏       | 7/32 [01:33<05:36, 13.45s/it]train probes:  25%|██▌       | 8/32 [01:46<05:22, 13.45s/it]train probes:  28%|██▊       | 9/32 [02:00<05:09, 13.45s/it]train probes:  31%|███▏      | 10/32 [02:14<04:58, 13.56s/it]train probes:  34%|███▍      | 11/32 [02:27<04:46, 13.63s/it]train probes:  38%|███▊      | 12/32 [02:41<04:32, 13.61s/it]train probes:  41%|████      | 13/32 [02:55<04:19, 13.64s/it]train probes:  44%|████▍     | 14/32 [03:08<04:05, 13.62s/it]train probes:  47%|████▋     | 15/32 [03:22<03:51, 13.64s/it]train probes:  50%|█████     | 16/32 [03:35<03:36, 13.56s/it]train probes:  53%|█████▎    | 17/32 [03:49<03:23, 13.54s/it]train probes:  56%|█████▋    | 18/32 [04:02<03:10, 13.58s/it]train probes:  59%|█████▉    | 19/32 [04:16<02:57, 13.62s/it]train probes:  62%|██████▎   | 20/32 [04:30<02:44, 13.74s/it]train probes:  66%|██████▌   | 21/32 [04:44<02:29, 13.63s/it]train probes:  69%|██████▉   | 22/32 [04:57<02:16, 13.68s/it]train probes:  72%|███████▏  | 23/32 [05:13<02:08, 14.33s/it]train probes:  75%|███████▌  | 24/32 [05:31<02:03, 15.50s/it]train probes:  78%|███████▊  | 25/32 [05:49<01:52, 16.02s/it]train probes:  81%|████████▏ | 26/32 [06:09<01:43, 17.23s/it]train probes:  84%|████████▍ | 27/32 [06:23<01:21, 16.30s/it]train probes:  88%|████████▊ | 28/32 [06:38<01:04, 16.09s/it]train probes:  91%|█████████ | 29/32 [06:55<00:48, 16.14s/it]train probes:  94%|█████████▍| 30/32 [07:10<00:31, 15.83s/it]train probes:  97%|█████████▋| 31/32 [07:32<00:17, 17.86s/it]train probes: 100%|██████████| 32/32 [08:07<00:00, 22.95s/it]train probes: 100%|██████████| 32/32 [08:07<00:00, 15.24s/it]
ASSUMES OPENAI_API_KEY ENVIRONMENT VARIABLE IS SET
The tokenizer class you load from this checkpoint is not the same type as the class this function is called from. It may result in unexpected tokenization. 
The tokenizer class you load from this checkpoint is 'LlamaTokenizer'. 
The class this function is called from is 'LLaMATokenizer'.
normalizer.cc(51) LOG(INFO) precompiled_charsmap is empty. use identity normalization.
  0%|          | 0/81 [00:00<?, ?it/s]/home/jxf/anaconda3/envs/iti/lib/python3.8/site-packages/transformers/generation/configuration_utils.py:377: UserWarning: `do_sample` is set to `False`. However, `top_k` is set to `1` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `top_k`.
  warnings.warn(
  1%|          | 1/81 [00:29<39:35, 29.69s/it]  2%|▏         | 2/81 [00:49<31:47, 24.15s/it]  4%|▎         | 3/81 [01:15<32:21, 24.90s/it]  5%|▍         | 4/81 [01:36<29:56, 23.33s/it]  6%|▌         | 5/81 [02:04<31:27, 24.84s/it]  7%|▋         | 6/81 [02:32<32:30, 26.00s/it]  9%|▊         | 7/81 [02:52<29:29, 23.91s/it] 10%|▉         | 8/81 [03:08<26:07, 21.47s/it] 11%|█         | 9/81 [03:35<27:54, 23.26s/it] 12%|█▏        | 10/81 [03:52<25:18, 21.38s/it] 14%|█▎        | 11/81 [04:16<25:40, 22.00s/it] 15%|█▍        | 12/81 [04:41<26:39, 23.18s/it] 16%|█▌        | 13/81 [05:03<25:53, 22.84s/it] 17%|█▋        | 14/81 [05:27<25:43, 23.04s/it] 19%|█▊        | 15/81 [05:55<26:56, 24.50s/it] 20%|█▉        | 16/81 [06:26<28:43, 26.51s/it] 21%|██        | 17/81 [06:51<27:39, 25.92s/it] 22%|██▏       | 18/81 [07:14<26:25, 25.17s/it] 23%|██▎       | 19/81 [07:33<24:00, 23.24s/it] 25%|██▍       | 20/81 [08:00<24:53, 24.49s/it] 26%|██▌       | 21/81 [08:18<22:21, 22.37s/it] 27%|██▋       | 22/81 [08:40<21:51, 22.23s/it] 28%|██▊       | 23/81 [09:02<21:25, 22.17s/it] 30%|██▉       | 24/81 [09:25<21:18, 22.43s/it] 31%|███       | 25/81 [09:45<20:26, 21.90s/it] 32%|███▏      | 26/81 [10:10<20:59, 22.89s/it] 33%|███▎      | 27/81 [10:34<20:44, 23.04s/it] 35%|███▍      | 28/81 [11:00<21:05, 23.87s/it] 36%|███▌      | 29/81 [11:29<22:14, 25.66s/it] 37%|███▋      | 30/81 [11:59<22:43, 26.73s/it] 38%|███▊      | 31/81 [12:24<21:49, 26.19s/it] 40%|███▉      | 32/81 [12:49<21:05, 25.83s/it] 41%|████      | 33/81 [13:16<21:03, 26.31s/it] 42%|████▏     | 34/81 [13:41<20:15, 25.86s/it] 43%|████▎     | 35/81 [14:07<19:58, 26.06s/it] 44%|████▍     | 36/81 [14:39<20:53, 27.85s/it] 46%|████▌     | 37/81 [15:05<19:50, 27.06s/it] 47%|████▋     | 38/81 [15:30<19:01, 26.54s/it] 48%|████▊     | 39/81 [15:55<18:10, 25.97s/it] 49%|████▉     | 40/81 [16:19<17:26, 25.54s/it] 51%|█████     | 41/81 [16:43<16:46, 25.17s/it] 52%|█████▏    | 42/81 [17:03<15:12, 23.41s/it] 53%|█████▎    | 43/81 [17:20<13:41, 21.63s/it] 54%|█████▍    | 44/81 [17:42<13:26, 21.80s/it] 56%|█████▌    | 45/81 [18:04<13:02, 21.75s/it] 57%|█████▋    | 46/81 [18:25<12:29, 21.40s/it] 58%|█████▊    | 47/81 [18:44<11:45, 20.75s/it] 59%|█████▉    | 48/81 [19:02<10:59, 20.00s/it] 60%|██████    | 49/81 [19:28<11:33, 21.67s/it] 62%|██████▏   | 50/81 [19:49<11:07, 21.54s/it] 63%|██████▎   | 51/81 [20:11<10:48, 21.62s/it] 64%|██████▍   | 52/81 [20:30<10:05, 20.89s/it] 65%|██████▌   | 53/81 [20:52<09:50, 21.10s/it] 67%|██████▋   | 54/81 [21:11<09:15, 20.57s/it] 68%|██████▊   | 55/81 [21:27<08:23, 19.38s/it] 69%|██████▉   | 56/81 [21:33<06:17, 15.10s/it] 70%|███████   | 57/81 [21:37<04:44, 11.87s/it] 72%|███████▏  | 58/81 [21:41<03:42,  9.66s/it] 73%|███████▎  | 59/81 [21:46<02:59,  8.17s/it] 74%|███████▍  | 60/81 [21:51<02:30,  7.17s/it] 75%|███████▌  | 61/81 [21:55<02:07,  6.36s/it] 77%|███████▋  | 62/81 [22:01<01:55,  6.09s/it] 78%|███████▊  | 63/81 [22:05<01:40,  5.61s/it] 79%|███████▉  | 64/81 [22:10<01:32,  5.47s/it] 80%|████████  | 65/81 [22:15<01:21,  5.11s/it] 81%|████████▏ | 66/81 [22:20<01:15,  5.03s/it] 83%|████████▎ | 67/81 [22:24<01:09,  4.96s/it] 84%|████████▍ | 68/81 [22:29<01:03,  4.86s/it] 85%|████████▌ | 69/81 [22:34<00:58,  4.86s/it] 86%|████████▋ | 70/81 [22:38<00:50,  4.61s/it] 88%|████████▊ | 71/81 [22:42<00:44,  4.46s/it] 89%|████████▉ | 72/81 [22:46<00:37,  4.22s/it] 90%|█████████ | 73/81 [22:49<00:32,  4.01s/it] 91%|█████████▏| 74/81 [22:53<00:26,  3.84s/it] 93%|█████████▎| 75/81 [22:56<00:22,  3.72s/it] 94%|█████████▍| 76/81 [23:00<00:19,  3.84s/it] 95%|█████████▌| 77/81 [23:05<00:16,  4.12s/it] 96%|█████████▋| 78/81 [23:10<00:13,  4.34s/it] 98%|█████████▊| 79/81 [23:15<00:09,  4.61s/it] 99%|█████████▉| 80/81 [23:20<00:04,  4.66s/it]100%|██████████| 81/81 [23:25<00:00,  4.71s/it]100%|██████████| 81/81 [23:25<00:00, 17.35s/it]
  0%|          | 0/81 [00:00<?, ?it/s]  1%|          | 1/81 [00:01<01:56,  1.45s/it]  2%|▏         | 2/81 [00:02<01:32,  1.17s/it]  4%|▎         | 3/81 [00:03<01:28,  1.13s/it]  5%|▍         | 4/81 [00:04<01:18,  1.02s/it]  6%|▌         | 5/81 [00:05<01:14,  1.02it/s]  7%|▋         | 6/81 [00:05<01:06,  1.12it/s]  9%|▊         | 7/81 [00:06<01:01,  1.19it/s] 10%|▉         | 8/81 [00:07<00:58,  1.24it/s] 11%|█         | 9/81 [00:09<01:22,  1.15s/it] 12%|█▏        | 10/81 [00:10<01:13,  1.04s/it] 14%|█▎        | 11/81 [00:11<01:25,  1.22s/it] 15%|█▍        | 12/81 [00:13<01:32,  1.34s/it] 16%|█▌        | 13/81 [00:13<01:13,  1.08s/it] 17%|█▋        | 14/81 [00:14<01:08,  1.03s/it] 19%|█▊        | 15/81 [00:15<01:02,  1.05it/s] 20%|█▉        | 16/81 [00:16<01:00,  1.07it/s] 21%|██        | 17/81 [00:16<00:48,  1.33it/s] 22%|██▏       | 18/81 [00:18<01:01,  1.02it/s] 23%|██▎       | 19/81 [00:19<01:07,  1.08s/it] 25%|██▍       | 20/81 [00:21<01:21,  1.34s/it] 26%|██▌       | 21/81 [00:22<01:11,  1.19s/it] 27%|██▋       | 22/81 [00:23<01:08,  1.17s/it] 28%|██▊       | 23/81 [00:24<01:00,  1.04s/it] 30%|██▉       | 24/81 [00:25<01:03,  1.12s/it] 31%|███       | 25/81 [00:26<01:07,  1.21s/it] 32%|███▏      | 26/81 [00:27<00:57,  1.05s/it] 33%|███▎      | 27/81 [00:28<00:58,  1.09s/it] 35%|███▍      | 28/81 [00:29<00:54,  1.02s/it] 36%|███▌      | 29/81 [00:31<00:57,  1.11s/it] 37%|███▋      | 30/81 [00:33<01:16,  1.51s/it] 38%|███▊      | 31/81 [00:35<01:30,  1.80s/it] 40%|███▉      | 32/81 [00:37<01:20,  1.64s/it] 41%|████      | 33/81 [00:38<01:17,  1.62s/it] 42%|████▏     | 34/81 [00:39<01:06,  1.42s/it] 43%|████▎     | 35/81 [00:41<01:08,  1.49s/it] 44%|████▍     | 36/81 [00:42<00:56,  1.25s/it] 46%|████▌     | 37/81 [00:42<00:47,  1.09s/it] 47%|████▋     | 38/81 [00:43<00:40,  1.07it/s] 48%|████▊     | 39/81 [00:44<00:47,  1.13s/it] 49%|████▉     | 40/81 [00:46<00:48,  1.19s/it] 51%|█████     | 41/81 [00:48<00:56,  1.42s/it] 52%|█████▏    | 42/81 [00:50<01:06,  1.70s/it] 53%|█████▎    | 43/81 [00:51<00:57,  1.52s/it] 54%|█████▍    | 44/81 [00:54<01:07,  1.82s/it] 56%|█████▌    | 45/81 [00:55<00:56,  1.57s/it] 57%|█████▋    | 46/81 [00:56<00:54,  1.56s/it] 58%|█████▊    | 47/81 [00:57<00:48,  1.44s/it] 59%|█████▉    | 48/81 [00:59<00:49,  1.49s/it] 60%|██████    | 49/81 [01:00<00:48,  1.50s/it] 62%|██████▏   | 50/81 [01:02<00:48,  1.56s/it] 63%|██████▎   | 51/81 [01:03<00:39,  1.33s/it] 64%|██████▍   | 52/81 [01:05<00:47,  1.62s/it] 65%|██████▌   | 53/81 [01:07<00:44,  1.60s/it] 67%|██████▋   | 54/81 [01:08<00:38,  1.42s/it] 68%|██████▊   | 55/81 [01:09<00:32,  1.27s/it] 69%|██████▉   | 56/81 [01:11<00:36,  1.44s/it] 70%|███████   | 57/81 [01:12<00:37,  1.58s/it] 72%|███████▏  | 58/81 [01:13<00:30,  1.33s/it] 73%|███████▎  | 59/81 [01:14<00:26,  1.20s/it] 74%|███████▍  | 60/81 [01:15<00:22,  1.08s/it] 75%|███████▌  | 61/81 [01:17<00:24,  1.23s/it] 77%|███████▋  | 62/81 [01:18<00:23,  1.23s/it] 78%|███████▊  | 63/81 [01:19<00:20,  1.16s/it] 79%|███████▉  | 64/81 [01:20<00:18,  1.08s/it] 80%|████████  | 65/81 [01:20<00:15,  1.05it/s] 81%|████████▏ | 66/81 [01:21<00:13,  1.15it/s] 83%|████████▎ | 67/81 [01:22<00:12,  1.09it/s] 84%|████████▍ | 68/81 [01:23<00:11,  1.14it/s] 85%|████████▌ | 69/81 [01:24<00:10,  1.13it/s] 86%|████████▋ | 70/81 [01:24<00:08,  1.24it/s] 88%|████████▊ | 71/81 [01:25<00:08,  1.21it/s] 89%|████████▉ | 72/81 [01:27<00:09,  1.03s/it] 90%|█████████ | 73/81 [01:28<00:08,  1.06s/it] 91%|█████████▏| 74/81 [01:28<00:06,  1.06it/s] 93%|█████████▎| 75/81 [01:29<00:04,  1.21it/s] 94%|█████████▍| 76/81 [01:30<00:04,  1.19it/s] 95%|█████████▌| 77/81 [01:31<00:04,  1.02s/it] 96%|█████████▋| 78/81 [01:33<00:03,  1.18s/it] 98%|█████████▊| 79/81 [01:34<00:02,  1.19s/it] 99%|█████████▉| 80/81 [01:35<00:01,  1.04s/it]100%|██████████| 81/81 [01:35<00:00,  1.12it/s]100%|██████████| 81/81 [01:35<00:00,  1.18s/it]
Running BLEU / ROUGE!
/home/jxf/code/honest_llm/TruthfulQA/truthfulqa/metrics.py:277: FutureWarning: load_metric is deprecated and will be removed in the next major version of datasets. Use 'evaluate.load' instead, from the new library 🤗 Evaluate: https://huggingface.co/docs/evaluate
  bleurt = load_metric("bleurt", cache_dir=cache_dir)
WARNING:datasets.builder:Found cached dataset openwebtext-10k (/home/jxf/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 651.49it/s]
Map:   0%|          | 0/100 [00:00<?, ? examples/s]/home/jxf/code/honest_llm/utils.py:729: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  owt = dataset.map(lambda x: {'input_ids': torch.tensor(tokenizer(x['text'], return_tensors='pt')['input_ids'][:,:128])})
Map:  10%|█         | 10/100 [00:00<00:00, 92.06 examples/s]Map:  31%|███       | 31/100 [00:00<00:00, 156.64 examples/s]Map:  47%|████▋     | 47/100 [00:00<00:00, 147.47 examples/s]Map:  67%|██████▋   | 67/100 [00:00<00:00, 161.53 examples/s]Map:  91%|█████████ | 91/100 [00:00<00:00, 112.54 examples/s]                                                               0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:13,  7.33it/s]  3%|▎         | 3/100 [00:00<00:08, 11.03it/s]  5%|▌         | 5/100 [00:00<00:07, 12.76it/s]  7%|▋         | 7/100 [00:00<00:06, 13.93it/s]  9%|▉         | 9/100 [00:00<00:06, 14.64it/s] 11%|█         | 11/100 [00:00<00:05, 15.06it/s] 13%|█▎        | 13/100 [00:00<00:05, 14.80it/s] 15%|█▌        | 15/100 [00:01<00:05, 14.74it/s] 17%|█▋        | 17/100 [00:01<00:06, 13.29it/s] 19%|█▉        | 19/100 [00:01<00:05, 14.06it/s] 21%|██        | 21/100 [00:01<00:05, 13.93it/s] 23%|██▎       | 23/100 [00:01<00:05, 14.31it/s] 25%|██▌       | 25/100 [00:01<00:05, 14.86it/s] 27%|██▋       | 27/100 [00:01<00:04, 14.98it/s] 29%|██▉       | 29/100 [00:02<00:04, 15.09it/s] 31%|███       | 31/100 [00:02<00:04, 15.51it/s] 33%|███▎      | 33/100 [00:02<00:04, 15.47it/s] 35%|███▌      | 35/100 [00:02<00:04, 15.40it/s] 37%|███▋      | 37/100 [00:02<00:03, 15.82it/s] 39%|███▉      | 39/100 [00:02<00:03, 15.66it/s] 41%|████      | 41/100 [00:02<00:03, 15.51it/s] 43%|████▎     | 43/100 [00:02<00:03, 15.79it/s] 45%|████▌     | 45/100 [00:03<00:03, 15.53it/s] 47%|████▋     | 47/100 [00:03<00:03, 15.41it/s] 49%|████▉     | 49/100 [00:03<00:03, 15.72it/s] 51%|█████     | 51/100 [00:03<00:03, 15.47it/s] 53%|█████▎    | 53/100 [00:03<00:03, 15.35it/s] 55%|█████▌    | 55/100 [00:03<00:02, 15.74it/s] 57%|█████▋    | 57/100 [00:03<00:02, 15.62it/s] 59%|█████▉    | 59/100 [00:03<00:02, 15.44it/s] 61%|██████    | 61/100 [00:04<00:02, 15.81it/s] 63%|██████▎   | 63/100 [00:04<00:02, 15.82it/s] 65%|██████▌   | 65/100 [00:04<00:02, 15.79it/s] 67%|██████▋   | 67/100 [00:04<00:02, 16.05it/s] 69%|██████▉   | 69/100 [00:04<00:01, 16.04it/s] 71%|███████   | 71/100 [00:04<00:01, 15.66it/s] 73%|███████▎  | 73/100 [00:04<00:01, 14.85it/s] 75%|███████▌  | 75/100 [00:04<00:01, 15.47it/s] 77%|███████▋  | 77/100 [00:05<00:01, 15.33it/s] 79%|███████▉  | 79/100 [00:05<00:01, 15.83it/s] 81%|████████  | 81/100 [00:05<00:01, 15.83it/s] 83%|████████▎ | 83/100 [00:05<00:01, 15.78it/s] 85%|████████▌ | 85/100 [00:05<00:00, 16.00it/s] 87%|████████▋ | 87/100 [00:05<00:00, 15.88it/s] 89%|████████▉ | 89/100 [00:05<00:00, 15.69it/s] 91%|█████████ | 91/100 [00:06<00:00, 15.39it/s] 93%|█████████▎| 93/100 [00:06<00:00, 15.69it/s] 95%|█████████▌| 95/100 [00:06<00:00, 14.78it/s] 97%|█████████▋| 97/100 [00:06<00:00, 12.92it/s] 99%|█████████▉| 99/100 [00:06<00:00, 11.06it/s]100%|██████████| 100/100 [00:06<00:00, 14.76it/s]
WARNING:datasets.builder:Found cached dataset openwebtext-10k (/home/jxf/.cache/huggingface/datasets/stas___openwebtext-10k/plain_text/1.0.0/3a8df094c671b4cb63ed0b41f40fb3bd855e9ce2e3765e5df50abcdfb5ec144b)
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:00<00:00, 691.56it/s]
Map:   0%|          | 0/100 [00:00<?, ? examples/s]/home/jxf/code/honest_llm/utils.py:768: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  owt = dataset.map(lambda x: {'input_ids': torch.tensor(tokenizer(x['text'], return_tensors='pt')['input_ids'][:,:128])})
Map:  18%|█▊        | 18/100 [00:00<00:00, 159.80 examples/s]Map:  36%|███▌      | 36/100 [00:00<00:00, 122.15 examples/s]Map:  55%|█████▌    | 55/100 [00:00<00:00, 137.87 examples/s]Map:  85%|████████▌ | 85/100 [00:00<00:00, 151.83 examples/s]                                                               0%|          | 0/100 [00:00<?, ?it/s]  1%|          | 1/100 [00:00<00:18,  5.23it/s]  2%|▏         | 2/100 [00:00<00:18,  5.38it/s]  3%|▎         | 3/100 [00:00<00:16,  5.87it/s]  4%|▍         | 4/100 [00:00<00:17,  5.41it/s]  5%|▌         | 5/100 [00:00<00:16,  5.73it/s]  6%|▌         | 6/100 [00:01<00:17,  5.44it/s]  7%|▋         | 7/100 [00:01<00:16,  5.47it/s]  8%|▊         | 8/100 [00:01<00:16,  5.46it/s]  9%|▉         | 9/100 [00:01<00:15,  5.70it/s] 10%|█         | 10/100 [00:01<00:16,  5.41it/s] 11%|█         | 11/100 [00:02<00:16,  5.37it/s] 12%|█▏        | 12/100 [00:02<00:16,  5.41it/s] 13%|█▎        | 13/100 [00:02<00:16,  5.39it/s] 14%|█▍        | 14/100 [00:02<00:15,  5.43it/s] 15%|█▌        | 15/100 [00:02<00:15,  5.39it/s] 16%|█▌        | 16/100 [00:02<00:14,  5.85it/s] 17%|█▋        | 17/100 [00:03<00:13,  6.20it/s] 18%|█▊        | 18/100 [00:03<00:12,  6.58it/s] 19%|█▉        | 19/100 [00:03<00:12,  6.50it/s] 20%|██        | 20/100 [00:03<00:11,  6.81it/s] 21%|██        | 21/100 [00:03<00:11,  6.73it/s] 22%|██▏       | 22/100 [00:03<00:11,  7.00it/s] 23%|██▎       | 23/100 [00:03<00:10,  7.04it/s] 24%|██▍       | 24/100 [00:03<00:10,  7.25it/s] 25%|██▌       | 25/100 [00:04<00:10,  7.07it/s] 26%|██▌       | 26/100 [00:04<00:10,  7.16it/s] 27%|██▋       | 27/100 [00:04<00:10,  7.14it/s] 28%|██▊       | 28/100 [00:04<00:09,  7.23it/s] 29%|██▉       | 29/100 [00:04<00:09,  7.16it/s] 30%|███       | 30/100 [00:04<00:09,  7.31it/s] 31%|███       | 31/100 [00:05<00:11,  6.14it/s] 32%|███▏      | 32/100 [00:05<00:11,  5.94it/s] 33%|███▎      | 33/100 [00:05<00:12,  5.36it/s] 34%|███▍      | 34/100 [00:05<00:12,  5.18it/s] 35%|███▌      | 35/100 [00:05<00:11,  5.43it/s] 36%|███▌      | 36/100 [00:06<00:12,  5.32it/s] 37%|███▋      | 37/100 [00:06<00:11,  5.41it/s] 38%|███▊      | 38/100 [00:06<00:11,  5.42it/s] 39%|███▉      | 39/100 [00:06<00:11,  5.45it/s] 40%|████      | 40/100 [00:06<00:11,  5.41it/s] 41%|████      | 41/100 [00:06<00:10,  5.43it/s] 42%|████▏     | 42/100 [00:07<00:10,  5.59it/s] 43%|████▎     | 43/100 [00:07<00:10,  5.41it/s] 44%|████▍     | 44/100 [00:07<00:09,  5.67it/s] 45%|████▌     | 45/100 [00:07<00:10,  5.48it/s] 46%|████▌     | 46/100 [00:07<00:09,  5.44it/s] 47%|████▋     | 47/100 [00:08<00:09,  5.43it/s] 48%|████▊     | 48/100 [00:08<00:09,  5.41it/s] 49%|████▉     | 49/100 [00:08<00:09,  5.34it/s] 50%|█████     | 50/100 [00:08<00:09,  5.34it/s] 51%|█████     | 51/100 [00:08<00:09,  5.35it/s] 52%|█████▏    | 52/100 [00:08<00:08,  5.79it/s] 53%|█████▎    | 53/100 [00:09<00:07,  6.11it/s] 54%|█████▍    | 54/100 [00:09<00:07,  6.49it/s] 55%|█████▌    | 55/100 [00:09<00:06,  6.56it/s] 56%|█████▌    | 56/100 [00:09<00:06,  6.67it/s] 57%|█████▋    | 57/100 [00:09<00:06,  6.68it/s] 58%|█████▊    | 58/100 [00:09<00:06,  6.90it/s] 59%|█████▉    | 59/100 [00:09<00:05,  7.04it/s] 60%|██████    | 60/100 [00:10<00:05,  6.71it/s] 61%|██████    | 61/100 [00:10<00:06,  6.30it/s] 62%|██████▏   | 62/100 [00:10<00:06,  6.07it/s] 63%|██████▎   | 63/100 [00:10<00:06,  5.89it/s] 64%|██████▍   | 64/100 [00:10<00:06,  5.83it/s] 65%|██████▌   | 65/100 [00:10<00:06,  5.64it/s] 66%|██████▌   | 66/100 [00:11<00:06,  5.59it/s] 67%|██████▋   | 67/100 [00:11<00:06,  5.50it/s] 68%|██████▊   | 68/100 [00:11<00:05,  5.62it/s] 69%|██████▉   | 69/100 [00:11<00:05,  5.38it/s] 70%|███████   | 70/100 [00:11<00:05,  5.32it/s] 71%|███████   | 71/100 [00:12<00:05,  5.38it/s] 72%|███████▏  | 72/100 [00:12<00:05,  5.53it/s] 73%|███████▎  | 73/100 [00:12<00:04,  5.42it/s] 74%|███████▍  | 74/100 [00:12<00:04,  5.66it/s] 75%|███████▌  | 75/100 [00:12<00:04,  5.48it/s] 76%|███████▌  | 76/100 [00:13<00:04,  5.43it/s] 77%|███████▋  | 77/100 [00:13<00:04,  5.65it/s] 78%|███████▊  | 78/100 [00:13<00:04,  5.41it/s] 79%|███████▉  | 79/100 [00:13<00:03,  5.79it/s] 80%|████████  | 80/100 [00:13<00:03,  6.12it/s] 81%|████████  | 81/100 [00:13<00:02,  6.53it/s] 82%|████████▏ | 82/100 [00:13<00:02,  6.67it/s] 83%|████████▎ | 83/100 [00:14<00:02,  6.96it/s] 84%|████████▍ | 84/100 [00:14<00:02,  6.69it/s] 85%|████████▌ | 85/100 [00:14<00:02,  6.56it/s] 86%|████████▌ | 86/100 [00:14<00:02,  6.07it/s] 87%|████████▋ | 87/100 [00:14<00:02,  6.09it/s] 88%|████████▊ | 88/100 [00:14<00:02,  5.79it/s] 89%|████████▉ | 89/100 [00:15<00:01,  5.92it/s] 90%|█████████ | 90/100 [00:15<00:01,  5.64it/s] 91%|█████████ | 91/100 [00:15<00:01,  5.83it/s] 92%|█████████▏| 92/100 [00:15<00:01,  5.57it/s] 93%|█████████▎| 93/100 [00:15<00:01,  5.83it/s] 94%|█████████▍| 94/100 [00:15<00:01,  5.59it/s] 95%|█████████▌| 95/100 [00:16<00:00,  5.58it/s] 96%|█████████▌| 96/100 [00:16<00:00,  5.84it/s] 97%|█████████▋| 97/100 [00:16<00:00,  5.66it/s] 98%|█████████▊| 98/100 [00:16<00:00,  5.83it/s] 99%|█████████▉| 99/100 [00:16<00:00,  5.50it/s]100%|██████████| 100/100 [00:17<00:00,  5.72it/s]100%|██████████| 100/100 [00:17<00:00,  5.87it/s]
results: 
 Metric    BLEURT acc  GPT-info acc  ...   CE Loss  KL wrt Orig
Model                               ...                       
llama_7B    0.382716      0.950617  ...  2.165586          0.0

[1 rows x 9 columns]
FOLD 0
Metric    BLEURT acc  GPT-info acc  ...   CE Loss  KL wrt Orig
Model                               ...                       
llama_7B    0.382716      0.950617  ...  2.165586          0.0

[1 rows x 9 columns]
[0.38271605 0.95061728 0.18518519 0.33333333 0.41026059 0.2962963
 0.32098765 2.16558594 0.        ]
True*Info Score: 0.1760402377686328, True Score: 0.18518518518518517, Info Score: 0.9506172839506173, BLEURT acc: 0.3827, MC1: 0.3333, MC2: 0.4103, bleu acc: 0.2963, rouge1 acc: 0.3210, CE Loss: 2.1655859375, KL wrt Original: 0.0
